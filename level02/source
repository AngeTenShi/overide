#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(int argc, const char **argv, const char **envp)
{
    char username[96];
    int password_length;
    char password[48];
    char input[96];
    int access_granted;
    int password_read;
    FILE *password_file;

    memset(input, 0, sizeof(input));
    access_granted = 0;
    memset(password, 0, sizeof(password));
    memset(username, 0, sizeof(username));
    password_length = 0;
    password_file = NULL;
    password_read = 0;

    password_file = fopen("/home/users/level03/.pass", "r");
    if (!password_file)
    {
        fwrite("ERROR: failed to open password file\n", 1uLL, 36uLL, stderr);
        exit(1);
    }

    password_read = fread(password, 1uLL, 41uLL, password_file);
    password[strcspn(password, "\n")] = 0;

    if (password_read != 41)
    {
        fwrite("ERROR: failed to read password file\n", 1uLL, 35uLL, stderr);
        fwrite("ERROR: failed to read password file\n", 1uLL, 35uLL, stderr);
        exit(1);
    }

    fclose(password_file);

    puts("===== [ Secure Access System v1.0 ] =====");
    puts("/***************************************\\");
    puts("| You must login to access this system. |");
    puts("\\**************************************/");

    printf("--[ Username: ");
    fgets(username, 100, stdin);
    username[strcspn(username, "\n")] = 0;

    printf("--[ Password: ");
    fgets(input, 100, stdin);
    input[strcspn(input, "\n")] = 0;

    puts("*****************************************");

    if (strncmp(password, input, 41uLL))
    {
        printf(username);
        puts(" does not have access!");
        exit(1);
    }

    printf("Greetings, %s!\n", username);
    system("/bin/sh");

    return 0;
}